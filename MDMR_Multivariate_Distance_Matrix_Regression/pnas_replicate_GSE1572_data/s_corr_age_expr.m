load data.txt
load cov.txt
age=cov(:,1);
clear cov;
probe=importdata('probe.txt');
%%
X=age;
fv=ones(length(data),1);
pv=ones(length(data),1);
for k=1:length(data)
    k
    Y=data(k,:)';
    [Pperm,Fstat]=MDMR_test(X,Y);
    fv(k)=Fstat;
    pv(k)=Pperm;
end
[~,idx]=sort(-fv);

Y=data(idx(1:100),:)';
[Pperm,Fstat,var_explained,D]=MDMR_test(X,Y);
Pperm
Fstat
var_explained
pcolor(D)



%%
pv=ones(length(data),1);
for k=1:length(data)
    [r,pv(k)]=corr(data(k,:)',age,'type','s');    
end
%sum(pv<0.001)
i=pv<0.001;

X=age;
Y=data(i,:)';

%[Pperm,Fstat,var_explained,D]=MDMR_test(X,Y(:,1:29))
[Pperm,Fstat,var_explained,D]=MDMR_test(X,Y)


%%
sigprobe={'1011_s_at','34642_at','37512_at','31503_at','35471_g_at','31883_at','31794_at','38335_at','41530_at','40544_g_at','38479_at','31737_at','33102_at','693_g_at','714_at','32527_at','37331_g_at','33899_at','31525_s_at','39690_at','38286_at','38842_at','684_at','39850_at','31792_at','37747_at','36681_at','40096_at','34973_at','39791_at','37053_at','41090_s_at','33033_at','33742_f_at','34890_at','37038_at','41362_at','41278_at','39692_at','41356_at','1909_at','38515_at','37465_at','37915_at','36209_at','35115_at','36570_at','37157_at','39647_s_at','31813_at','1421_at','41738_at','41144_g_at','41287_s_at','1158_s_at','41257_at','33385_g_at','41012_r_at','33404_at','41447_at','40739_at','36119_at','339_at','32833_at','33299_at','37481_at','35232_f_at','40013_at','33891_at','2083_at','38111_at','38112_g_at','34763_at','33426_at','33400_r_at','32523_at','38995_at','39142_at','32667_at','31809_at','39706_at','38976_at','40382_at','32242_at','32243_g_at','40698_at','40165_at','36273_at','38474_at','38700_at','859_at','826_at','37214_g_at','36149_at','36643_at','39411_at','41402_at','38717_at','275_at','41226_at','35333_r_at','357_at','40319_at','34815_at','1703_g_at','32551_at','35394_at','36410_f_at','39642_at','33883_at','39011_at','39012_g_at','587_at','34249_at','39674_r_at','37073_at','41720_r_at','41719_i_at','34678_at','996_at','41673_at','41674_at','468_at','36232_at','41806_at','1593_at','1363_at','31805_at','267_at','953_g_at','36120_at','31946_s_at','34717_s_at','32109_at','40479_at','40240_at','31817_at','35098_at','38339_at','32531_at','1692_s_at','32612_at','40185_at','37183_at','36853_at','36854_s_at','38236_at','36596_r_at','36595_s_at','36788_at','35806_at','35253_at','38875_r_at','38176_at','37908_at','38079_at','38580_at','1820_g_at','32249_at','36984_f_at','36925_at','645_at','40637_at','1179_at','41454_at','32052_at','31687_f_at','35644_at','41283_at','39827_at','34308_at','38943_at','38364_at','35310_at','41247_at','41642_at','34840_at','39750_at','36092_at','34887_at','36236_at','33072_at','33466_at','35143_at','33193_at','36564_at','34303_at','40238_at','33806_at','37027_at','1039_s_at','33378_at','38545_at','41536_at','118_at','37272_at','35924_at','33162_at','40775_at','41300_s_at','39071_at','32808_at','38454_g_at','38453_at','36412_s_at','1456_s_at','1825_at','33893_r_at','1052_s_at','35030_i_at','33241_at','38694_at','40492_at','36066_at','35878_at','39526_at','37225_at','39057_at','34924_at','40833_r_at','1495_at','33830_at','34800_at','33878_at','41195_at','37366_at','40060_r_at','38098_at','37024_at','36059_at','38402_at','38403_at','609_f_at','37712_g_at','38051_at','36897_at','926_at','36130_f_at','39081_at','37363_at','32571_at','39531_at','183_at','35422_at','1972_s_at','310_s_at','113_i_at','1550_at','33214_at','976_s_at','38431_at','1712_s_at','1327_s_at','40771_at','41770_at','36206_at','36448_at','32537_at','33182_at','38280_s_at','40608_at','35603_at','32119_at','33318_at','39037_at','33447_at','35362_at','34873_at','36977_at','40289_at','39240_at','32652_g_at','38268_at','980_at','34752_at','33606_g_at','33605_at','36933_at','853_at','1461_at','35705_at','31858_at','35136_at','34950_at','841_at','40624_at','38614_s_at','35764_at','33367_s_at','1557_at','1558_g_at','38754_at','41191_at','35494_at','40504_at','41665_at','32056_at','38653_at','39354_at','38365_at','37694_at','34797_at','1163_at','37685_at','38526_at','36509_at','36151_at','352_at','353_at','37397_at','268_at','39525_at','36577_at','35719_at','33783_at','32193_at','40434_at','34202_at','34614_at','34795_at','38291_at','39036_g_at','40803_at','718_at','1217_g_at','1336_s_at','363_at','362_at','32185_at','32141_at','40513_at','936_s_at','38415_at','41780_at','1190_at','37738_g_at','41158_at','1064_at','37678_at','39760_at','1074_at','620_at','600_at','622_at','1753_s_at','36437_s_at','40146_at','41318_g_at','41317_at','39532_at','36550_at','37598_at','31949_at','1839_at','1840_g_at','1921_at','1922_g_at','35668_at','942_at','35756_at','41086_at','34272_at','34273_at','1318_at','33457_at','32597_at','32552_at','32215_i_at','32216_r_at','37402_at','31948_at','865_at','37990_at','235_at','41302_at','34728_g_at','33303_at','32521_at','34363_at','33118_at','38033_at','39167_r_at','32142_at','34849_at','39691_at','40782_at','41379_at','35285_at','34918_at','36567_at','38520_r_at','37782_at','1430_at','39537_at','38409_at','41199_s_at','36005_at','35277_at','36688_at','40419_at','38677_at','40962_s_at','36748_at','38075_at','32178_r_at','39757_at','32166_at','39416_at','38805_at','31508_at','36123_at','39395_at','1581_s_at','38568_at','41503_at','33876_at','40631_at','1815_g_at','38404_at','31827_s_at','32829_at','892_at','37958_at','32083_at','36128_at','35341_at','368_at','36113_s_at','38641_at','330_s_at','37611_at','35402_at','40076_at','34822_at','35007_at','34760_at','1629_s_at','39560_at','40619_at','893_at','33781_s_at','1164_at','39293_at','36515_at','37686_s_at','36653_g_at','36100_at','37268_at','31608_g_at','1585_at','32787_at','40147_at','33780_at','35783_at','1519_at','34091_s_at','607_s_at','1674_at','35164_at','34751_at','35681_r_at','35825_s_at','698_f_at'};
[~,idx]=ismember(sigprobe,probe);
X=age;
Y=data(idx,:)';

%%
[Pperm,Fstat,var_explained,D]=MDMR_test(X,Y);

pcolor(D)
var_explained
Pperm


